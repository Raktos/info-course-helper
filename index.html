<!DOCTYPE html>
<html>
    <head lang="en">
        <meta charset="UTF-8">
        <title>iSchool Course Helper</title>

        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css">
        <link rel="stylesheet" href="css/main.css">

        <script src="https://cdnjs.cloudflare.com/ajax/libs/angular.js/1.3.3/angular.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/angular-ui-bootstrap/0.11.2/ui-bootstrap-tpls.min.js"></script>
        <!--<script src="https://cdnjs.cloudflare.com/ajax/libs/angular.js/1.3.3/angular-cookies.min.js"></script>-->
    </head>
    <body ng-app="CoursesApp" ng-controller="CoursesController">
    <header>
        <h1>Informatics Course Helper</h1>
        <p class="lead">Easier to view classes</p>

    </header>


    <!--TODO fix nav to viewport on scroll-->
    <nav class="quarterSelectors" id="nav">

        <div class="btn-group">
            <button type="button"  class="btn-quarterSelect" ng-click="quarterSort.aut = !quarterSort.aut" ng-class="{btnActive: quarterSort.aut}" >Autumn</button>
            <button type="button"  class="btn-quarterSelect" ng-click="quarterSort.win = !quarterSort.win" ng-class="{btnActive: quarterSort.win}" >Winter</button>
            <button type="button"  class="btn-quarterSelect" ng-click="quarterSort.spr = !quarterSort.spr" ng-class="{btnActive: quarterSort.spr}" >Spring</button>
            <button type="button"  class="btn-quarterSelect" ng-click="quarterSort.sum = !quarterSort.sum" ng-class="{btnActive: quarterSort.sum}" >Summer</button>
        </div>
    </nav>

    <div class="nav-placeholder"></div>

    <main ng-if="!loading">

        <!--TODO something broke search. Find it.-->
        <div class="search">
            <div class="container-search">
                <span class="icon"><i class="fa fa-search"></i></span>
                <input type="text" class="searchBox" id="search" ng-model="searchString" placeholder="Search..." />
            </div>
        </div>


        <div class="courseCategory" ng-repeat="category in coursesAll">
            <h2>{{category.category}}</h2>
            <div class="courseBlock" ng-repeat="course in category.coursesFiltered  | filter : searchString" ng-if="quarterCheck(course)">
                <!--TODO filter by quarter-->

                <h3 class="courseTitle">{{course.school}} {{course.number}} - {{course.title}}</h3>

                <div class="courseQuarters">
                    <img ng-if="course.autumn" src="img/autumn.png" alt="autumn"/>
                    <img ng-if="!course.autumn" src="img/blank.png" alt="autumn"/>

                    <img ng-if="course.winter" src="img/winter.png" alt="winter"/>
                    <img ng-if="!course.winter" src="img/blank.png" alt="winter"/>

                    <img ng-if="course.spring" src="img/spring.png" alt="spring"/>
                    <img ng-if="!course.spring" src="img/blank.png" alt="spring"/>

                    <img ng-if="course.summer" src="img/summer.png" alt="summer"/>
                    <img ng-if="!course.summer" src="img/blank.png" alt="summer"/>
                </div>

                <p class="courseCredits">({{course.credits}} credits) {{course.genre}}</p>

                <div class="collapsable" collapse="course.collapsed">
                    <p class="courseInfo">{{course.description}}</p>

                    <!--TODO Junior vs Senior year recommendation-->

                    <a href="https://uwstudent.washington.edu/student/myplan/course/{{course.school}}{{course.number}}" target="_blank">View in MyPlan</a>

                    <div class="coursePreReqs" ng-if="course.prerequisite">
                        <p>Requires: {{course.prerequisite}}</p>
                    </div>

                    <div class="commentsBlock collapsable" collapse="course.commentsCollapsed">
                        <h2>Comments</h2>
                        <div class="viewCommentsBlock">
                            <div class="viewComment" ng-repeat="comment in commentsRaw | filter : {courseId: course.objectId}">
                                <div class="rating">
                                    <rating name="rating" max="5" ng-model="comment.rating" readonly="true"></rating>
                                </div>
                                <h3 class="commentTitle">{{comment.title}}</h3>
                                <p class="name">{{comment.name}}</p>
                                <p class="commentBody">{{comment.body}}</p>
                                <div class="score">
                                    {{comment.score}}
                                    <span class="glyphicon glyphicon-thumbs-up thumbUp" ng-click="incrementScore(comment, 1)"></span>
                                    <span class="glyphicon glyphicon-thumbs-down thumbDown" ng-if="comment.score > 0" ng-click="incrementScore(comment, -1)"></span>
                                </div>
                            </div>
                        </div>
                        <div class="addCommentBlock">
                            <h3>Add Comment</h3>
                            <form class="commentForm" name="commentForm" ng-submit="addComment(course)">
                                <!--TODO form validation-->
                                <div class="form-group">
                                    <label>Rating</label><br>
                                    <rating name="rating" max="5" ng-model="newComment.rating"></rating>
                                </div>
                                <div class="form-group formName">
                                    <label for="name">Name</label>
                                    <input class="form-control" type="text" name="name" id="name" placeholder="Name..." ng-model="newComment.name"/>
                                </div>
                                <div class="form-group formTitle">
                                    <label for="commentTitle">Comment Title</label>
                                    <input class="form-control" type="text" name="commentTitle" id="commentTitle" placeholder="Title..." ng-model="newComment.title"/>
                                </div>
                                <div class="form-group formBody">
                                    <label for="commentBody">Comments</label>
                                    <textarea class="form-control" name="commentBody" id="commentBody" placeholder="Comments..." ng-model="newComment.body"></textarea>
                                </div>
                                <div class="form-group">
                                    <button type="submit" class="btn btn-primary" ng-if="!loading"><!--ng-disabled="inserting"-->Submit Comment</button>
                                    <img src="img/ajax-spinner.gif" alt="loading" ng-if="loading"/>
                                </div>
                                <!--<h3>TEMP newComment Object Status</h3>-->
                                <!--<p>{{newComment}}</p>-->
                            </form>
                        </div>
                    </div>
                    <span class="pull-right glyphicon collapseButton" ng-click="course.commentsCollapsed = !course.commentsCollapsed" ng-class="{'glyphicon-chevron-down': course.commentsCollapsed, 'glyphicon-chevron-up': !course.commentsCollapsed}"></span>
                </div>

                <span class="pull-left glyphicon collapseButton" ng-click="course.collapsed = !course.collapsed" ng-class="{'glyphicon-chevron-down': course.collapsed, 'glyphicon-chevron-up': !course.collapsed}"></span>
            </div>
        </div>

        <!--TODO back to top-->
    </main>
    <!--TODO loading gif-->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/2.4.1/lodash.min.js"></script>
    <script src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
    <script src="js/app.js"></script>
    </body>
</html>
